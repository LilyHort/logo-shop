function _(n){let a=n.querySelector(".card__price-quantity-input"),i=n.querySelector(".card__price-unit .card__price-current"),l=n.querySelector(".card__price-total .card__price-current"),t=n.querySelector(".card__price-total .card__price-old");if(!a||!i||!l)return;let e=parseInt(a.value,10),c=parseInt(n.dataset.basePrice,10);c||(c=parseInt(i.textContent.replace(/[^\d]/g,""),10),n.dataset.basePrice=c);let s=c*e;if(l.textContent=`${s.toLocaleString("ru-RU")} \u20BD`,t&&!t.classList.contains("card__price-old--none")){let r=parseInt(n.dataset.baseOldPrice,10);if(r||(r=parseInt(t.textContent.replace(/[^\d]/g,""),10),n.dataset.baseOldPrice=r),r){let u=r*e;t.textContent=`${u.toLocaleString("ru-RU")} \u20BD`}}v()}function v(){let n=document.querySelectorAll(".card__item:not(.card__item-deleted)"),a=document.querySelector(".basket__count"),i=document.querySelector(".basket__total"),l=document.querySelector(".total__final-value"),t=document.querySelector(".header__nav-user-item:not(.header__nav-user-item--mobile) .header__nav-user-item-count"),e=document.querySelector(".total__item--products .total__price"),c=document.querySelector(".total__item--discount .total__price"),s=0,r=0,u=0;if(n.forEach(o=>{let d=o.querySelector(".card__price-quantity-input"),y=o.querySelector(".card__price-total .card__price-current"),p=o.querySelector(".card__price-total .card__price-old");if(d&&y){let b=parseInt(d.value,10),h=parseInt(y.textContent.replace(/[^\d]/g,""),10),f=0;p&&!p.classList.contains("card__price-old--none")&&(f=parseInt(p.textContent.replace(/[^\d]/g,""),10)),s+=b,r+=h,u+=f}}),a&&(a.textContent=s),i&&(i.textContent=r.toLocaleString("ru-RU")),e){let o=e.querySelector(".ruble--total");o?e.innerHTML=`${r.toLocaleString("ru-RU")}&nbsp;${o.outerHTML}`:e.textContent=`${r.toLocaleString("ru-RU")} \u20BD`}if(c&&u>0){let o=u-r,d=c.querySelector(".ruble--discount");d?c.innerHTML=`-&nbsp;${o.toLocaleString("ru-RU")}&nbsp;${d.outerHTML}`:c.textContent=`- ${o.toLocaleString("ru-RU")} \u20BD`}if(l){let o=l.querySelector(".ruble--total-price");o?l.innerHTML=`${r.toLocaleString("ru-RU")}&nbsp;${o.outerHTML}`:l.textContent=`${r.toLocaleString("ru-RU")} \u20BD`}t&&(t.textContent=s),S()}function S(){let n=document.querySelector(".header__nav-user-item--mobile .header__nav-user-item-count"),a=8;n&&(n.textContent=a)}function q(n,a){let i=n.querySelector(".card__price-quantity-input");if(!i)return;let t=parseInt(i.value,10)+a;t<1&&(t=1),t>100&&(t=100),i.value=t,_(n)}function m(){let n=document.querySelectorAll(".card__price-quantity-input"),a=document.querySelectorAll(".card__price-quantity-button--minus"),i=document.querySelectorAll(".card__price-quantity-button--plus");document.querySelectorAll(".card__item:not(.card__item-deleted)").forEach(t=>{let e=t.querySelector(".card__price-unit .card__price-current"),c=t.querySelector(".card__price-unit .card__price-old"),s=t.querySelector(".card__price-total .card__price-old");if(e){let r=parseInt(e.textContent.replace(/[^\d]/g,""),10);t.dataset.basePrice=r}if(c&&!c.classList.contains("card__price-old--none")){let r=parseInt(c.textContent.replace(/[^\d]/g,""),10);t.dataset.baseOldPrice=r}else if(s&&!s.classList.contains("card__price-old--none")){let r=t.querySelector(".card__price-quantity-input"),u=r?parseInt(r.value,10):1,o=parseInt(s.textContent.replace(/[^\d]/g,""),10),d=Math.round(o/u);t.dataset.baseOldPrice=d}_(t)}),S(),a.forEach(t=>{t.addEventListener("click",function(){let e=this.closest(".card__item");q(e,-1)})}),i.forEach(t=>{t.addEventListener("click",function(){let e=this.closest(".card__item");q(e,1)})}),n.forEach(t=>{t.addEventListener("input",function(){let e=parseInt(this.value,10);isNaN(e)||e<1?this.value=1:this.value=e;let c=this.closest(".card__item");_(c)})}),n.forEach(t=>{t.addEventListener("blur",function(){if(this.value===""||parseInt(this.value,10)<1){this.value=1;let e=this.closest(".card__item");_(e)}})})}export{m as initGoodsChanging};
