function I(){let e=document.querySelector(".total"),t=document.querySelector(".contacts-personal__map");if(e&&t&&window.innerWidth>=768){let o=e.offsetWidth;t.style.setProperty("--total-width",`${o}px`)}}window.addEventListener("load",I);window.addEventListener("resize",I);var p=document.querySelector(".header__nav-main-button"),x=document.querySelector(".header__nav-main-list");p.classList.add("header__nav-main-button--open");function T(){x.classList.toggle("header__nav-main-list--open"),p.classList.contains("header__nav-main-button--open")?(p.classList.remove("header__nav-main-button--open"),p.classList.add("header__nav-main-button--close")):(p.classList.remove("header__nav-main-button--close"),p.classList.add("header__nav-main-button--open"))}p.addEventListener("click",T);var O=document.querySelectorAll(".card__size-item");function P(){if(this.classList.contains("card__size-item--none"))return;this.closest(".card__item").querySelectorAll(".card__size-item").forEach(i=>{i.classList.remove("card__size-item--active");let n=i.querySelector(".card__size-label");n&&n.classList.remove("card__size-label--active")}),this.classList.add("card__size-item--active");let o=this.querySelector(".card__size-label");o&&o.classList.add("card__size-label--active")}O.forEach(e=>{e.addEventListener("click",P)});var k=document.querySelectorAll(".card__color-item");function A(){this.closest(".card__item").querySelectorAll(".card__color-item").forEach(i=>{i.classList.remove("card__color-item--active");let n=i.querySelector(".card__color-label");n&&n.classList.remove("card__color-label--active")}),this.classList.add("card__color-item--active");let o=this.querySelector(".card__color-label");o&&o.classList.add("card__color-label--active")}k.forEach(e=>{e.addEventListener("click",A)});var z=document.querySelectorAll(".card__price-quantity-input"),M=document.querySelectorAll(".card__price-quantity-button--minus"),D=document.querySelectorAll(".card__price-quantity-button--plus");function h(e){let t=e.querySelector(".card__price-quantity-input"),o=e.querySelector(".card__price-unit .card__price-current"),i=e.querySelector(".card__price-total .card__price-current"),n=e.querySelector(".card__price-total .card__price-old");if(!t||!o||!i)return;let r=parseInt(t.value,10),l=parseInt(e.dataset.basePrice,10);l||(l=parseInt(o.textContent.replace(/[^\d]/g,""),10),e.dataset.basePrice=l);let c=l*r;if(i.textContent=`${c.toLocaleString("ru-RU")} \u20BD`,n&&!n.classList.contains("card__price-old--none")){let a=parseInt(e.dataset.baseOldPrice,10);if(a||(a=parseInt(n.textContent.replace(/[^\d]/g,""),10),e.dataset.baseOldPrice=a),a){let s=a*r;n.textContent=`${s.toLocaleString("ru-RU")} \u20BD`}}R()}function R(){let e=document.querySelectorAll(".card__item:not(.card__item-deleted)"),t=document.querySelector(".basket__count"),o=document.querySelector(".basket__total"),i=document.querySelector(".total__final-value"),n=document.querySelector(".header__nav-user-item:not(.header__nav-user-item--mobile) .header__nav-user-item-count"),r=document.querySelector(".total__item--products .total__price"),l=document.querySelector(".total__item--discount .total__price"),c=0,a=0,s=0;if(e.forEach(d=>{let m=d.querySelector(".card__price-quantity-input"),f=d.querySelector(".card__price-total .card__price-current"),_=d.querySelector(".card__price-total .card__price-old");if(m&&f){let y=parseInt(m.value,10),b=parseInt(f.textContent.replace(/[^\d]/g,""),10),v=0;_&&!_.classList.contains("card__price-old--none")&&(v=parseInt(_.textContent.replace(/[^\d]/g,""),10)),c+=y,a+=b,s+=v}}),t&&(t.textContent=c),o&&(o.textContent=a.toLocaleString("ru-RU")),r){let d=r.querySelector(".ruble--total");d?r.innerHTML=`${a.toLocaleString("ru-RU")}&nbsp;${d.outerHTML}`:r.textContent=`${a.toLocaleString("ru-RU")} \u20BD`}if(l&&s>0){let d=s-a,m=l.querySelector(".ruble--discount");m?l.innerHTML=`-&nbsp;${d.toLocaleString("ru-RU")}&nbsp;${m.outerHTML}`:l.textContent=`- ${d.toLocaleString("ru-RU")} \u20BD`}if(i){let d=i.querySelector(".ruble--total-price");d?i.innerHTML=`${a.toLocaleString("ru-RU")}&nbsp;${d.outerHTML}`:i.textContent=`${a.toLocaleString("ru-RU")} \u20BD`}n&&(n.textContent=c),w()}function w(){let e=document.querySelector(".header__nav-user-item--mobile .header__nav-user-item-count"),t=8;e&&(e.textContent=t)}function E(e,t){let o=e.querySelector(".card__price-quantity-input");if(!o)return;let n=parseInt(o.value,10)+t;n<1&&(n=1),n>100&&(n=100),o.value=n,h(e)}M.forEach(e=>{e.addEventListener("click",function(){let t=this.closest(".card__item");E(t,-1)})});D.forEach(e=>{e.addEventListener("click",function(){let t=this.closest(".card__item");E(t,1)})});z.forEach(e=>{e.addEventListener("input",function(){let t=parseInt(this.value,10);isNaN(t)||t<1?this.value=1:t>100&&(this.value=100);let o=this.closest(".card__item");h(o)}),e.addEventListener("blur",function(){if(this.value===""||parseInt(this.value,10)<1){this.value=1;let t=this.closest(".card__item");h(t)}})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".card__item:not(.card__item-deleted)").forEach(t=>{let o=t.querySelector(".card__price-unit .card__price-current"),i=t.querySelector(".card__price-unit .card__price-old"),n=t.querySelector(".card__price-total .card__price-old");if(o){let r=parseInt(o.textContent.replace(/[^\d]/g,""),10);t.dataset.basePrice=r}if(i&&!i.classList.contains("card__price-old--none")){let r=parseInt(i.textContent.replace(/[^\d]/g,""),10);t.dataset.baseOldPrice=r}else if(n&&!n.classList.contains("card__price-old--none")){let r=t.querySelector(".card__price-quantity-input"),l=r?parseInt(r.value,10):1,c=parseInt(n.textContent.replace(/[^\d]/g,""),10),a=Math.round(c/l);t.dataset.baseOldPrice=a}h(t)}),w()});var $=document.querySelectorAll(".contacts-personal__input");$.forEach(e=>{let t=e.parentElement.querySelector(".contacts-personal__label");if(!t)return;let o=e.placeholder;e.value.trim()!==""&&(t.classList.add("contacts-personal__label--visible"),e.placeholder=""),e.addEventListener("focus",()=>{t.classList.add("contacts-personal__label--visible"),e.placeholder=""}),e.addEventListener("input",()=>{e.value.trim()!==""?(t.classList.add("contacts-personal__label--visible"),e.placeholder=""):t.classList.remove("contacts-personal__label--visible")}),e.addEventListener("blur",()=>{e.value.trim()===""&&(t.classList.remove("contacts-personal__label--visible"),e.placeholder=o)})});var L="11d7d340d855116e8e9aaedbaefae9c02190e5e4",u=null,g=null;function U(){window.ymaps.ready(()=>{let e=document.querySelector(".contacts-personal__map"),t=document.querySelector("#address");if(!e||!t)return;e.classList.add("contacts-personal__map--visible"),u=new window.ymaps.Map(e,{center:[55.751574,37.573856],zoom:10,controls:["zoomControl"]});let o,i=window.innerWidth;window.addEventListener("resize",()=>{clearTimeout(o),o=setTimeout(()=>{let n=window.innerWidth;if(u&&Math.abs(n-i)>50){let r=u.getCenter(),l=u.getZoom(),c=[];u.geoObjects.each(a=>{a.geometry.getType()==="Point"&&c.push({coords:a.geometry.getCoordinates(),properties:a.properties.getAll()})}),u.destroy(),u=new window.ymaps.Map(e,{center:r,zoom:l,controls:["zoomControl"]}),c.forEach(a=>{let s=new window.ymaps.Placemark(a.coords,a.properties,{preset:"islands#blackDotIcon"});u.geoObjects.add(s),g=s}),u.events.add("click",a=>{let s=a.get("coords");S(s),window.ymaps.geocode(s).then(d=>{let f=d.geoObjects.get(0).getAddressLine();t.value=f;let _=t.parentElement.querySelector(".contacts-personal__label");_&&(_.classList.add("contacts-personal__label--visible"),t.placeholder="")})}),i=n}},220)}),u.events.add("click",n=>{let r=n.get("coords");S(r),window.ymaps.geocode(r).then(l=>{let a=l.geoObjects.get(0).getAddressLine();t.value=a;let s=t.parentElement.querySelector(".contacts-personal__label");s&&(s.classList.add("contacts-personal__label--visible"),t.placeholder="")})})})}function S(e,t=""){if(!u)return;g&&u.geoObjects.remove(g),g=new window.ymaps.Placemark(e,{hintContent:t||"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0439 \u0430\u0434\u0440\u0435\u0441",balloonContent:t||"\u041C\u0435\u0441\u0442\u043E\u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u0435"},{iconLayout:"default#image",iconImageHref:`data:image/svg+xml;base64,${btoa(`
      <svg width="27" height="39" viewBox="0 0 27 39" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M26.4283 13.1881C26.4283 20.4716 20.3428 32.1025 13.2141 38.6965C6.70158 32.7642 0 20.4716 0 13.1881C0 5.9045 5.91617 0 13.2141 0C20.5121 0 26.4283 5.9045 26.4283 13.1881Z" fill="black"/>
<circle cx="13.2141" cy="13.1881" r="8" fill="white"/>
</svg>
    `)}`,iconImageSize:[27,38],iconImageOffset:[-16,-16]}),u.geoObjects.add(g),u.setCenter(e,15);let o=document.querySelector(".contacts-personal__map");o&&o.classList.add("contacts-personal__map--visible")}function j(){let e=document.createElement("ul");return e.className="address-suggestions",e}function N(){let e=document.querySelector("#address");if(!e||!L||L==="YOUR_DADATA_TOKEN")return;let t=e.parentElement;t.style.position="relative";let o=j();t.appendChild(o);let i;function n(c){return fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Token ${L}`},body:JSON.stringify({query:c,count:5})}).then(a=>a.json()).catch(()=>({suggestions:[]}))}function r(c){if(o.innerHTML="",c.length===0){o.classList.remove("address-suggestions--visible");return}c.forEach(a=>{let s=document.createElement("li");s.className="address-suggestions__item",s.textContent=a.value,s.addEventListener("click",()=>{l(a)}),o.appendChild(s)}),o.classList.add("address-suggestions--visible")}function l(c){e.value=c.value,o.classList.remove("address-suggestions--visible");let a=[parseFloat(c.data.geo_lat),parseFloat(c.data.geo_lon)];a[0]&&a[1]&&S(a,c.value);let s=e.parentElement.querySelector(".contacts-personal__label");s&&(s.classList.add("contacts-personal__label--visible"),e.placeholder="")}e.addEventListener("input",function(){let c=this.value.trim();if(clearTimeout(i),c.length<3){o.classList.remove("address-suggestions--visible");return}i=setTimeout(()=>{n(c).then(a=>{r(a.suggestions||[])})},300)}),document.addEventListener("click",c=>{t.contains(c.target)||o.classList.remove("address-suggestions--visible")})}function q(e){let t=e.value.trim(),o=e.type,i=e.hasAttribute("required");e.classList.remove("error");let n=e.parentNode.querySelector(".contacts-personal__error");n&&n.remove();let r=!0,l="";return i&&!t&&(r=!1,l="\u042D\u0442\u043E \u043F\u043E\u043B\u0435 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F"),e.name==="name"&&t&&(/^[а-яё\s]+$/i.test(t)||(r=!1,l="\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u0431\u0443\u043A\u0432\u044B")),e.name==="surname"&&t&&(/^[а-яё\s]+$/i.test(t)||(r=!1,l="\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u0431\u0443\u043A\u0432\u044B")),o==="email"&&t&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(r=!1,l="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 email \u0430\u0434\u0440\u0435\u0441")),e.name==="phone"&&t&&(/^[\+]?[0-9\s\-\(\)]{10,}$/.test(t)||(r=!1,l="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")),r||(e.classList.add("error"),F(e,l)),r}function F(e,t){let o=document.createElement("div");o.className="contacts-personal__error show",o.textContent=t,e.parentNode.appendChild(o)}function W(){document.querySelectorAll(".contacts-personal__input").forEach(t=>{t.addEventListener("blur",function(){q(this)}),t.addEventListener("input",function(){clearTimeout(this.validationTimeout),this.validationTimeout=setTimeout(()=>{q(this)},500)})})}function H(){let e=document.querySelector(".form"),t=document.querySelector(".total__button");if(console.log("\u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u0444\u043E\u0440\u043C\u044B \u0437\u0430\u043A\u0430\u0437\u0430:",{form:e,submitButton:t}),!e||!t){console.error("\u0424\u043E\u0440\u043C\u0430 \u0438\u043B\u0438 \u043A\u043D\u043E\u043F\u043A\u0430 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B!",{form:e,submitButton:t});return}t.addEventListener("click",o=>{o.preventDefault(),console.log('\u041A\u043D\u043E\u043F\u043A\u0430 "\u041E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437" \u043D\u0430\u0436\u0430\u0442\u0430!'),C(e)}),e.addEventListener("submit",o=>{o.preventDefault(),console.log("\u0424\u043E\u0440\u043C\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430!"),C(e)})}function C(e){let t=new FormData(e),o=[];document.querySelectorAll(".card__item:not(.card__item-deleted)").forEach((d,m)=>{let f=d.querySelector(".card__title")?.textContent?.trim()||"",_=d.querySelector(".card__size-item--active .card__size-label")?.textContent?.trim()||"",y=d.querySelector(".card__color-item--active")?.classList.toString().match(/card__color-item--(\w+)/)?.[1]||"",b=d.querySelector(".card__price-quantity-input")?.value||"1",v=d.querySelector(".card__price-total .card__price-current")?.textContent?.replace(/[^\d]/g,"")||"0";o.push({id:m+1,title:f,size:_,color:y,quantity:parseInt(b,10),price:parseInt(v,10)})});let n=document.querySelector(".payment__input:checked"),r=n?n.value:"",l=document.querySelector("#promo")?.value?.trim()||"",c=document.querySelector("#option")?.checked||!1,a=document.querySelector(".total__final-value")?.textContent?.replace(/[^\d]/g,"")||"0",s={name:t.get("name")||"",surname:t.get("surname")||"",phone:t.get("phone")||"",email:t.get("email")||"",address:t.get("address")||"",paymentMethod:r,comment:t.get("comment")||"",promoCode:l,option:c,cartItems:o,totalAmount:parseInt(a,10),timestamp:new Date().toISOString(),userAgent:navigator.userAgent};console.log("=== \u0414\u0410\u041D\u041D\u042B\u0415 \u0417\u0410\u041A\u0410\u0417\u0410 ==="),console.log("FormData \u043E\u0431\u044A\u0435\u043A\u0442:",t),console.log("\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0437\u0430\u043A\u0430\u0437\u0430:",s),console.log("==================="),console.log("\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435:",{name:s.name,surname:s.surname,phone:s.phone,email:s.email,address:s.address}),console.log("\u0422\u043E\u0432\u0430\u0440\u044B \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0435:",s.cartItems),console.log("\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B:",s.paymentMethod),console.log("\u0418\u0442\u043E\u0433\u043E\u0432\u0430\u044F \u0441\u0443\u043C\u043C\u0430:",s.totalAmount)}function V(){let e=document.querySelector(".comment__input"),t=document.querySelector(".comment__validation"),o=document.querySelector(".comment__validation-count");if(!e||!t||!o)return;let i=142;function n(){let r=e.value.length;o.textContent=r,e.classList.remove("comment__input--error","comment__input--warning"),t.classList.remove("comment__validation--error","comment__validation--warning"),r>i?(e.classList.add("comment__input--error"),t.classList.add("comment__validation--error")):r>i-20&&(e.classList.add("comment__input--warning"),t.classList.add("comment__validation--warning"))}e.addEventListener("input",n),n()}document.addEventListener("DOMContentLoaded",()=>{let e=()=>{typeof window.ymaps<"u"?U():setTimeout(e,500)};e(),N(),W(),H(),V(),B()});function B(){document.querySelectorAll(".total__option-toggle-icon").forEach(t=>{t.addEventListener("click",function(){this.classList.toggle("total__option-toggle-icon--checked")})})}
